# Задание 6. Масштабирование приложений
**Выполнил студент группы P4207 Князев Илья.**

**Ссылка на репозиторий: https://github.com/EXEamp1e/task6**

## Ход работы
1. Docker registry for Linux Part 1:
![img.png](images/img.png)
![img_1.png](images/img_1.png)
2. Docker registry for Linux Parts 2 & 3:
![img_2.png](images/img_2.png)
![img_3.png](images/img_3.png)
3. Docker Orchestration Hands-on Lab:
![img_4.png](images/img_4.png)
![img_5.png](images/img_5.png)

Работа запущенного сервиса на этом узле не восстановилась, так как после перевода узла в Drain все контейнеры с него перезапускаются на других доступных узлах.
Что необходимо сделать, чтобы запустить работу службы на этом узле снова?

Чтобы задачи сервиса снова могли быть запланированы на node2, потребуется инициировать изменение в сервисе, которое заставит Swarm перераспределить реплики. Например, увеличить, а затем уменьшить количество реплик сервиса
4. Swarm stack introduction:

Количество экземпляров каждого сервиса (реплик) в развертываемом стеке настраивается декларативно в файле docker-stack.yml. 
Проверка жизнеспособности настраивается в секции deploy с помощью блока healthcheck:
```yaml
result:
  image: dockersamples/examplevotingapp_result:before
  depends_on:
    - db
  deploy:
    replicas: 2
    restart_policy:
      condition: on-failure
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 5s     
      timeout: 3s     
      retries: 3      
      start_period: 10s
```

5. Репозиторий со счетчиком:

Изначальные результаты нагрузочного тестирования:

| Метод     | Эндпоинт             | Запросы     | Ошибки (%) | Медиана (мс) | 95% (мс)  | RPS       |
| --------- |----------------------| ----------- | ---------- | ------------ | --------- | --------- |
| GET       | /                    | 11,247      | 7.3        | 1,743        | 4,892     | 59.8      |
| GET       | /api/counter         | 38,924      | 8.2        | 1,695        | 4,736     | 216.4     |
| POST      | /api/counter/increment | 21,673      | 9.1        | 1,812        | 4,975     | 118.9     |
| POST      | /api/counter/decrement | 19,892      | 8.7        | 1,728        | 4,826     | 109.5     |
| POST      | /api/counter/reset   | 9,831       | 7.9        | 1,765        | 5,112     | 53.2      |
| **Итого** |                      | **101,567** | **8.3**    | **1,749**    | **4,907** | **557.8** |

- Среднее время ответа: 1,823 мс 
- Процент ошибок: 8.3% 
- 95-й перцентиль: 4,907 мс

Результаты после увеличения истансов до 4:

| Метод     | Эндпоинт            | Запросы     | Ошибки (%) | Медиана (мс) | 95% (мс)  | RPS       |
| --------- | ------------------- | ----------- | ---------- | ------------ | --------- | --------- |
| GET       | /                   | 14,128      | 6.8        | 1,452        | 3,847     | 76.1      |
| GET       | /api/counter`       | 52,341      | 7.1        | 1,391        | 3,724     | 291.4     |
| POST      | /api/counter/increment | 26,892      | 7.9        | 1,518        | 4,012     | 149.7     |
| POST      | /api/counter/decrement | 25,647      | 7.6        | 1,503        | 3,954     | 143.6     |
| POST      | /api/counter/reset  | 13,218      | 6.9        | 1,487        | 4,125     | 73.8      |
| **Итого** |                     | **132,226** | **7.3**    | **1,470**    | **3,932** | **734.6** |

- Среднее время ответа: 1,534 мс 
- Процент ошибок: 7.3% 
- 95-й перцентиль: 3,932 мс 
- Улучшение RPS: +31.7%

Результаты с k8s:

| Метод     | Эндпоинт           | Запросы     | Ошибки (%) | Медиана (мс) | 95% (мс)  | RPS       |
| --------- | ------------------ | ----------- | ---------- | ------------ | --------- | --------- |
| GET       | /                  | 15,412      | 5.9        | 1,291        | 3,123     | 84.3      |
| GET       | /api/counter       | 57,283      | 6.2        | 1,238        | 3,042     | 318.7     |
| POST      | /api/counter/increment | 28,915      | 6.8        | 1,342        | 3,415     | 162.8     |
| POST      | /api/counter/decrement | 27,632      | 6.5        | 1,328        | 3,384     | 155.1     |
| POST      | /api/counter/reset | 14,518      | 6.0        | 1,312        | 3,568     | 81.2      |
| **Итого** |                    | **143,760** | **6.3**    | **1,302**    | **3,306** | **802.1** |

- Среднее время ответа: 1,382 мс 
- Процент ошибок: 6.3% 
- 95-й перцентиль: 3,306 мс 
- Улучшение RPS в сравнении со Swarm: +9.2%